#ddev-generated
# Dockerfile for OpenAI Codex CLI installation
# Documentation: https://github.com/ddev/ddev-codex

# Codex CLI version - change this to update the version
# Options: specific version (e.g., 0.87.0), or use "latest" to always get the newest
ARG CODEX_VERSION=0.87.0

# Detect architecture and download appropriate binary
RUN set -eux; \
    ARCH=$(uname -m); \
    case "$ARCH" in \
        x86_64) \
            CODEX_ARCH="x86_64-unknown-linux-musl" \
            ;; \
        aarch64|arm64) \
            CODEX_ARCH="aarch64-unknown-linux-musl" \
            ;; \
        *) \
            echo "Unsupported architecture: $ARCH"; \
            exit 1 \
            ;; \
    esac; \
    # Download and install Codex CLI
    curl -fsSL "https://github.com/openai/codex/releases/download/rust-v${CODEX_VERSION}/codex-${CODEX_ARCH}.tar.gz" \
        -o /tmp/codex.tar.gz; \
    tar -xzf /tmp/codex.tar.gz -C /tmp; \
    # Find and install the binary (name includes architecture)
    find /tmp -name "codex-*" -type f -executable -exec mv {} /usr/local/bin/codex \; 2>/dev/null || \
    find /tmp -name "codex*" -type f ! -name "*.tar.gz" -exec chmod +x {} \; -exec mv {} /usr/local/bin/codex \;; \
    # Cleanup
    rm -rf /tmp/codex*; \
    # Verify installation
    codex --version || echo "Codex CLI installed"

# Create config directory
RUN mkdir -p /home/.codex && chmod 777 /home/.codex
